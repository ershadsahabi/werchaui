/* CartModal.module.css — Desktop: right-side drawer, Mobile: bottom-sheet (RTL friendly)
   هماهنگ با توکن‌های app/variables.css (Night/Day)
*/

/* ===== Backdrop ===== */
.backdrop {
  position: fixed;
  inset: 0;
  z-index: 90;
  display: grid;
  place-items: stretch;
  opacity: 0;
  pointer-events: none;
  background:
    radial-gradient(1000px 600px at 15% 10%, color-mix(in oklab, var(--primary) 11%, transparent), transparent 60%),
    radial-gradient(1000px 600px at 85% 90%, color-mix(in oklab, var(--secondary) 10%, transparent), transparent 60%),
    rgba(0,0,0,0);
  -webkit-backdrop-filter: none;
  backdrop-filter: none;
  transition: opacity var(--transition-300), backdrop-filter var(--transition-300), background-color var(--transition-300);
}
.open {
  opacity: 1;
  pointer-events: auto;
  -webkit-backdrop-filter: var(--backdrop);
  backdrop-filter: var(--backdrop);
  background:
    radial-gradient(1000px 600px at 15% 10%, color-mix(in oklab, var(--primary) 14%, transparent), transparent 60%),
    radial-gradient(1000px 600px at 85% 90%, color-mix(in oklab, var(--secondary) 12%, transparent), transparent 60%),
    rgba(0,0,0,.52);
}
:global(html.light) .open {
  background:
    radial-gradient(1000px 600px at 15% 10%, color-mix(in oklab, var(--primary) 12%, transparent), transparent 60%),
    radial-gradient(1000px 600px at 85% 90%, color-mix(in oklab, var(--secondary) 10%, transparent), transparent 60%),
    rgba(0,0,0,.30);
}

/* ===== Panel (Desktop: right-side) ===== */
.panel {
  position: fixed; /* مهم: پنل ثابت */
  inset-inline-end: 0; /* سمت راست در RTL/LTR */
  inset-block: 0;
  inline-size: min(480px, 92vw);
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--surface) 96%, black 4%),
      color-mix(in oklab, var(--surface-2) 96%, black 4%)
    );
  color: var(--text);
  border-inline-start: 1px solid color-mix(in oklab, var(--border) 70%, var(--text) 15%);
  box-shadow: -12px 0 40px rgba(0,0,0,.28), 0 0 0 1px color-mix(in oklab, var(--primary) 16%, transparent);
  transform: translateX(100%); /* از راست بیرون صفحه */
  transition: transform 420ms cubic-bezier(.18,.88,.24,1.1);
  display: grid;
  grid-template-rows: auto auto auto 1fr auto; /* header, sub, perks, list, footer */
  gap: 10px;
  padding: 16px;
}
.slideIn { transform: translateX(0); }

:global(html.light) .panel {
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--surface) 98%, white 2%),
      color-mix(in oklab, var(--surface-2) 98%, white 2%)
    );
  border-inline-start-color: color-mix(in oklab, var(--border) 75%, black 12%);
  box-shadow: -12px 0 36px rgba(16,24,40,.12), 0 0 0 1px color-mix(in oklab, var(--primary) 10%, transparent);
}

/* ===== Header ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-inline: 4px;
}
.titleWrap { display: flex; align-items: center; gap: .6rem; }
.title {
  display: flex;
  align-items: center;
  gap: .5rem;
  font-size: 1.2rem;
  font-weight: 900;
  color: var(--text-strong);
}
.badge {
  display: inline-grid;
  place-items: center;
  padding: .18rem .5rem;
  font-size: .72rem;
  font-weight: 900;
  border-radius: 999px;
  color: var(--on-accent);
  background: var(--grad-primary);
  box-shadow: 0 0 0 1px rgba(255,255,255,.18), inset 0 0 0 1px rgba(255,255,255,.22);
}
.countPill {
  padding: .24rem .6rem;
  font-size: .78rem;
  font-weight: 800;
  border-radius: 999px;
  background: color-mix(in oklab, var(--chip-bg) 72%, transparent);
  color: var(--chip-text);
  border: 1px solid color-mix(in oklab, var(--card-border) 70%, var(--text) 10%);
}
.close {
  --s: 36px;
  inline-size: var(--s);
  block-size: var(--s);
  display: grid;
  place-items: center;
  border-radius: 999px;
  border: 1px solid color-mix(in oklab, var(--text) 24%, var(--border) 76%);
  background: color-mix(in oklab, var(--surface-2) 90%, var(--primary) 6%);
  color: var(--text-strong);
  cursor: pointer;
  transition: transform var(--transition-300), background-color var(--transition-300), border-color var(--transition-300), box-shadow var(--transition-300);
}
.close:hover {
  transform: translateY(-1px);
  background: color-mix(in oklab, var(--surface-2) 84%, var(--primary) 12%);
  border-color: color-mix(in oklab, var(--primary) 38%, var(--border) 62%);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 20%, transparent);
}
.close:active { transform: translateY(0); }

/* Subhead */
.subhead {
  margin: 0 4px -2px;
  font-size: .92rem;
  color: color-mix(in oklab, var(--text) 86%, transparent);
}

/* ===== Perks & Free shipping progress ===== */
.perks {
  display: grid;
  grid-auto-flow: column;
  gap: 8px;
  align-items: center;
  justify-content: start;
}
.perk { 
  display: inline-flex; align-items: center; gap: 6px; 
  padding: 6px 10px; border-radius: 999px;
  background: color-mix(in oklab, var(--chip-bg) 80%, transparent);
  color: var(--chip-text);
  border: 1px solid color-mix(in oklab, var(--card-border) 70%, var(--text) 10%);
  font-weight: 700; font-size: .82rem;
}
.progressBox { display: grid; gap: 8px; margin-top: 2px; }
.progressMsg { color: var(--text-weak); font-weight: 700; }
.freeMsg { color: var(--success); font-weight: 900; }
.progressTrack {
  height: 10px; border-radius: 999px; overflow: hidden;
  background: color-mix(in oklab, var(--muted) 80%, transparent);
  border: 1px solid color-mix(in oklab, var(--border) 70%, var(--text) 10%);
}
.progressFill {
  height: 100%; width: 0%;
  background: var(--grad-calm);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.12);
  transition: width var(--transition-500);
}

/* ===== List ===== */
.list {
  overflow: auto;
  padding-inline: 4px;
  display: grid;
  gap: 12px;
  scrollbar-gutter: stable both-edges;
}
.row {
  position: relative;
  display: grid;
  grid-template-columns: 64px 1fr auto;
  gap: 12px;
  align-items: start;
  padding: 10px;
  border-radius: var(--radius);
  background: color-mix(in oklab, var(--surface) 92%, transparent);
  border: 1px solid color-mix(in oklab, var(--border) 72%, var(--text) 8%);
  animation: rowIn 320ms var(--transition-300) both;
}
@keyframes rowIn { from { opacity: 0; transform: translateY(4px);} to { opacity: 1; transform: translateY(0);} }
.low { box-shadow: 0 0 0 1px color-mix(in oklab, var(--warning) 40%, transparent); }
.lowBadge { color: var(--warning); font-weight: 900; }

.thumb {
  inline-size: 64px;
  block-size: 64px;
  border-radius: var(--radius-sm);
  object-fit: cover;
  border: 1px solid color-mix(in oklab, var(--border) 68%, var(--text) 10%);
  background: var(--muted);
}
.info { display: grid; gap: 6px; }
.name { font-weight: 900; color: var(--text-strong); line-height: 1.3; }
.line { display: flex; gap: 10px; align-items: baseline; flex-wrap: wrap; }
.unit { color: var(--text); font-weight: 700; }
.sub  { color: var(--text-weak); font-weight: 600; }
.stockNote { font-size: .8rem; color: color-mix(in oklab, var(--text) 78%, transparent); }
.out { color: var(--danger); font-weight: 800; }

/* Remove */
.remove {
  position: absolute;
  inset-inline-start: 8px;
  inset-block-start: 8px;
  inline-size: 28px;
  block-size: 28px;
  display: grid;
  place-items: center;
  border-radius: 999px;
  border: 1px solid color-mix(in oklab, var(--border) 70%, var(--text) 18%);
  background: color-mix(in oklab, var(--surface-2) 88%, transparent);
  color: var(--text);
  cursor: pointer;
  transition: background-color var(--transition-300), border-color var(--transition-300), transform var(--transition-300), box-shadow var(--transition-300);
}
.remove:hover {
  background: color-mix(in oklab, var(--danger) 16%, var(--surface-2) 84%);
  border-color: color-mix(in oklab, var(--danger) 40%, var(--border) 60%);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--danger) 22%, transparent);
  transform: translateY(-1px);
}

/* Qty */
.qty {
  display: grid;
  grid-auto-flow: column;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--surface) 86%, transparent);
  border: 1px solid color-mix(in oklab, var(--border) 70%, var(--text) 12%);
  padding: 6px;
  height: 40px;
}
.qty button {
  inline-size: 28px;
  block-size: 28px;
  display: grid;
  place-items: center;
  border: 1px solid color-mix(in oklab, var(--border) 70%, var(--text) 12%);
  background: color-mix(in oklab, var(--surface-2) 90%, var(--primary) 6%);
  color: var(--text-strong);
  border-radius: 999px;
  cursor: pointer;
  transition: background-color var(--transition-300), border-color var(--transition-300), transform var(--transition-300), box-shadow var(--transition-300);
}
.qty button:hover { transform: translateY(-1px); }
.qty button:disabled { opacity: .5; cursor: not-allowed; }
.qtyInput {
  inline-size: 64px;
  text-align: center;
  background: color-mix(in oklab, var(--surface) 92%, transparent);
  color: var(--text-strong);
  border: 1px solid color-mix(in oklab, var(--border) 70%, var(--text) 12%);
  border-radius: var(--radius-sm);
  height: 28px;
  font-weight: 800;
}

/* ===== Footer / Breakdown ===== */
.footer { border-top: 1px dashed color-mix(in oklab, var(--border) 75%, var(--text) 10%); padding-top: 12px; display: grid; gap: 10px; }
.breakdown { display: grid; gap: 8px; }
.lineItem { display: flex; align-items: center; justify-content: space-between; color: var(--text); }
.lineItem span { color: var(--text-weak); }
.lineItem b { font-weight: 900; }
.muted b, .muted span { opacity: .9; }
.good b { color: var(--success); }
.total { font-weight: 900; color: var(--text-strong); }
.total strong { color: var(--primary); }

.actions { display: grid; grid-template-columns: 1fr 1.2fr; gap: 10px; }

/* Buttons */
.primaryBtn,
.checkoutBtn {
  --h: 46px; height: var(--h);
  display: inline-grid; place-items: center;
  border-radius: var(--radius); border: 1px solid color-mix(in oklab, var(--btn-bg) 55%, var(--border) 45%);
  background: var(--btn-bg); color: var(--btn-text);
  font-weight: 900; letter-spacing: .01em;
  box-shadow: 0 8px 20px color-mix(in oklab, var(--btn-bg) 28%, transparent);
  transition: transform var(--transition-300), background-color var(--transition-300), border-color var(--transition-300), box-shadow var(--transition-300);
}
.primaryBtn:hover,
.checkoutBtn:hover { background: color-mix(in oklab, var(--btn-bg-press) 70%, var(--btn-bg) 30%); transform: translateY(-1px); }
.primaryBtn:active,
.checkoutBtn:active { transform: translateY(0); }

.ghostBtn {
  --h: 46px; height: var(--h);
  display: inline-grid; place-items: center;
  border-radius: var(--radius);
  border: 1px solid color-mix(in oklab, var(--text) 28%, var(--border) 72%);
  background: color-mix(in oklab, var(--surface) 90%, transparent);
  color: var(--text); font-weight: 800;
  transition: transform var(--transition-300), background-color var(--transition-300), border-color var(--transition-300), box-shadow var(--transition-300);
}
.ghostBtn:hover { transform: translateY(-1px); background: color-mix(in oklab, var(--surface-2) 92%, var(--primary) 8%); border-color: color-mix(in oklab, var(--primary) 30%, var(--border) 70%); box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary) 16%, transparent); }

/* Focus ring inside panel */
.panel :where(a, button, input):focus-visible { outline: none; box-shadow: 0 0 0 3px var(--focus-ring); }

/* Toast (اختیاری: اگر در TSX استفاده می‌کنی) */
.toast {
  position: absolute; inset-inline: 16px; inset-block-end: 16px; z-index: 2;
  padding: 10px 14px; border-radius: 999px;
  background: color-mix(in oklab, var(--surface-2) 86%, var(--success-weak) 14%);
  color: var(--text-strong); border: 1px solid color-mix(in oklab, var(--success) 24%, var(--border) 76%);
  opacity: 0; transform: translateY(6px);
  transition: opacity var(--transition-300), transform var(--transition-300);
  pointer-events: none; white-space: nowrap; font-weight: 800;
}
.toastShow { opacity: 1; transform: translateY(0); }

/* Scrollbars */
.list::-webkit-scrollbar { inline-size: 10px; }
.list::-webkit-scrollbar-thumb {
  background: color-mix(in oklab, var(--primary) 35%, transparent);
  border-radius: 999px; border: 2px solid transparent; background-clip: padding-box;
}
@supports (scrollbar-color: auto) {
  .list { scrollbar-color: color-mix(in oklab, var(--primary) 35%, transparent) transparent; scrollbar-width: thin; }
}

/* ===== Mobile: bottom-sheet ===== */
@media (max-width: 640px) {
  .panel {
    inset-inline: 0;
    inset-block-end: 0;
    inline-size: 100%;
    max-block-size: min(92vh, 720px);
    border-inline-start: none;
    border-block-start: 1px solid color-mix(in oklab, var(--border) 75%, var(--text) 12%);
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
    transform: translateY(100%); /* از پایین */
    box-shadow: 0 -10px 40px rgba(0,0,0,.28);
    grid-template-rows: auto auto auto 1fr auto; /* header, sub, perks, list, footer */
    padding-bottom: calc(16px + env(safe-area-inset-bottom));
  }
  .slideIn { transform: translateY(0); }
  .row { grid-template-columns: 64px 1fr; padding-inline-start: 10px; padding-inline-end: 40px; }
  .remove { inset-inline-start: auto; inset-inline-end: 8px; }
  .actions { grid-template-columns: 1fr; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .backdrop, .panel, .close, .remove, .qty button, .primaryBtn, .checkoutBtn, .ghostBtn, .progressFill, .row, .toast {
    transition: none !important;
  }
}
